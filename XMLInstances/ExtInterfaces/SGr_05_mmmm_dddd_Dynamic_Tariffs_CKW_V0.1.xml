<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/SGr.xsl"?>
<DeviceFrame xmlns="http://www.smartgridready.com/ns/V0/"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.smartgridready.com/ns/V0/ ../../SchemaDatabase/SGr/Product/Product.xsd">
  <deviceName>CKW Dynamic Tariffs</deviceName>
  <manufacturerName>CKW</manufacturerName>
  <specificationOwnerIdentification>0</specificationOwnerIdentification>
  <releaseNotes>
    <state>Draft</state>
    <changeLog>
      <version>0.1.0</version>
      <date>2025-09-16</date>
      <author>SGr/mkr</author>
      <comment>Initial draft</comment>
    </changeLog>
  </releaseNotes>
  <deviceInformation>
    <legibleDescription>
      <textElement>
        <![CDATA[
          CKW is offering two new dynamic tariff products for grid usage at grid level 7 for 2026.
          CKW Home dynamic (customers with annual consumption <50MWh) and CKW Business dynamic (customers with annual consumption >50MWh).
          The tariff profiles are based on the forecast grid load for the following day and are made available for the next day via an API by 6 p.m.
          The tariff profile (working tariff for grid usage) is standardized to a volume-weighted average value.
          The volume-weighted average value is slightly higher than the unit price of the standard grid product, but with a reduced power price.
        ]]>
      </textElement>
      <language>en</language>
      <uri>https://www.ckw.ch/energie/strom/dynamischer-tarif-fuer-privatkunden-und-unternehmen/dynamischer-tarif-technische-voraussetzungen</uri>
    </legibleDescription>
    <legibleDescription>
      <textElement>
        <![CDATA[
          CKW stellt für 2026 zwei neue dynamische Wahlprodukte für die Netznutzung auf Netzebene 7 zur Verfügung.
          CKW Home dynamic (Kunden <50MWh Jahresverbrauch) und CKW Business dynamic (Kunden >50MWh Jahresverbrauch).
          Die Tarifprofile orientieren sich an der prognostizierten Netzlast des Folgetages und werden jeweils bis 18:00 Uhr über eine API für den nächsten Tag zur Verfügung gestellt.
          Das Tarifprofil (Arbeitstarif der Netznutzung) wird jeweils an einen mengengewichteten Mittelwert normiert.
          Der mengengewichtete Mittelwert ist leicht höher als der Einheitspreis des Standardnetzproduktes, dafür mit einem reduzierten Leistungspreis.
        ]]>
      </textElement>
      <language>de</language>
      <uri>https://www.ckw.ch/energie/strom/dynamischer-tarif-fuer-privatkunden-und-unternehmen/dynamischer-tarif-technische-voraussetzungen</uri>
    </legibleDescription>
    <deviceCategory>DeviceInformation</deviceCategory>
    <isLocalControl>false</isLocalControl>
    <softwareRevision>1.0.0</softwareRevision>
    <hardwareRevision>-</hardwareRevision>
    <manufacturerSpecificationIdentification>CKWDynamicTariffs</manufacturerSpecificationIdentification>
    <levelOfOperation>5</levelOfOperation>
    <versionNumber>
      <primaryVersionNumber>0</primaryVersionNumber>
      <secondaryVersionNumber>1</secondaryVersionNumber>
      <subReleaseVersionNumber>0</subReleaseVersionNumber>
    </versionNumber>
    <testState>None</testState>
  </deviceInformation>
  <configurationList>
    <configurationListElement>
      <name>tariff_type</name>
      <dataType>
        <enum>
          <enumEntry>
            <literal>grid</literal>
            <description>Grid</description>
          </enumEntry>
          <enumEntry>
            <literal>integrated</literal>
            <description>Integrated</description>
          </enumEntry>
        </enum>
      </dataType>
      <defaultValue>grid</defaultValue>
      <configurationDescription>
        <textElement>The tariff type to get</textElement>
        <language>en</language>
        <label>Tariff Type</label>
      </configurationDescription>
      <configurationDescription>
        <textElement>Gewünschter Tarif-Typ</textElement>
        <language>de</language>
        <label>Tarif-Typ</label>
      </configurationDescription>
    </configurationListElement>
  </configurationList>
  <interfaceList>
    <restApiInterface>
      <restApiInterfaceDescription>
        <restApiInterfaceSelection>URI</restApiInterfaceSelection>
        <restApiUri>https://e-ckw-public-data.de-c1.eu1.cloudhub.io</restApiUri>
        <restApiAuthenticationMethod>NoSecurityScheme</restApiAuthenticationMethod>
      </restApiInterfaceDescription>
      <functionalProfileList>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>DynamicTariff</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>DynamicTariff</functionalProfileCategory>
              <functionalProfileType>Supplier</functionalProfileType>
              <levelOfOperation>5</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>1</primaryVersionNumber>
                <secondaryVersionNumber>0</secondaryVersionNumber>
                <subReleaseVersionNumber>0</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
            <legibleDescription>
              <textElement>
                <![CDATA[
                  The dynamic tariff structure offers a price that can change every 15 minutes.
                  <p>The functional profile contains all the necessary information to retrieve a series of data points with information on tariff values every 15 minutes.</p>
                  <p>The prices are available on an online interface (WEB-API), which an energy management system will use to plan the operation of various devices.</p>
                  <p><img src="ressources/dynamic_tariff.svg"/></p>
                  <p>This functional profile can only be provided by products with REST API interface.</p>
                  <p>The request for the tariffs defines the start time stamp and end time stamp of the interval the tariffs should be returned for.
                  Each entry in the resulting tariff list contains also the start time stamp and end time stamp of the sub intervals together with a list of entries with tariff unit and tariff value.</p>

                  The schema for the JSON created by the REST API is

<font size="1"><pre style="color:blue">
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Dynamic Tariffs",
  "description": "JSON schema for the delivery of tariffs",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "start_timestamp": {
        "description": "Start time stamp of the tariff interval",
        "type": "string"
      },
      "end_timestamp": {
        "description": "End time stamp of the tariff interval",
        "type": "string"
      },
      "integrated": {
        "description": "List of tariffs in that interval",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "component": {
              "description": "The optional name of the tariff",
              "type": "string"
            },
            "unit": {
              "description": "The tariff unit for the price",
              "type": "string"
            },
            "value": {
              "description": "The tariff price value",
              "type": "number"
            }
          },
          "propertyNames": {
            "type": "string",
            "pattern": "^(component|unit|value)$"
          },
          "required": [
            "unit",
            "value"
          ]
        }
      }
    },
    "propertyNames": {
      "type": "string",
      "pattern": "^(start_timestamp|end_timestamp|integrated)$"
    },
    "required": [
      "start_timestamp",
      "end_timestamp",
      "integrated"
    ]
  }
}
</pre></font>

          An example JSON is:

<font size="1"><pre style="color:blue">
[
    {
        "start_timestamp": "2025-01-01T00:00:00+01:00",
        "end_timestamp": "2025-01-01T00:15:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.4925
            }
        ]
    },
    {
        "start_timestamp": "2025-01-01T00:15:00+01:00",
        "end_timestamp": "2025-01-01T00:30:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.491133
            }
        ]
    },
    {
        "start_timestamp": "2025-01-01T00:30:00+01:00",
        "end_timestamp": "2025-01-01T00:45:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.486722
            }
        ]
    }
]
</pre></font>
                ]]>
              </textElement>
              <language>en</language>
            </legibleDescription>
            <legibleDescription>
              <textElement>
                <![CDATA[
                  Die dynamische Tarif-Struktur bietet einen Strompreis, der sich alle 15 Minuten ändern kann.</p>
                  <p>Das Funktionsprofil enthält alle nötigen Informationen, um eine Reihe von Datenpunkten mit Tarifinformationen alle 15 Minuten abzufragen.</p>
                  <p>Die Preise sind über ein Online-Interface (WEB-API) abrufbar, womit ein Energie-Management-System den Betrieb verschiedener Geräte zeitlich festlegt.</p>
                  <p><img src="ressources/dynamic_tariff.svg"/></p>
                  <p>Dieses Funktionsprofil kann nur mit Produkten genutzt werden, die ein REST API unterstützen.</p>
                  <p>Die Tarif-Abfrage definiert den Start- und End-Zeitpunkt des Intervalls, für das die Tarife abgerufen werden.
                      Jedes Element der resultierenden Tarif-Liste enthält auch den Start- und End-Zeitpunkt der Sub-Intervalle, in Kombination mit einer Liste von Elementen mit Tarif-Einheit und -Preis.</p>

                  Das JSON-Schema des REST API ist

<font size="1"><pre style="color:blue">
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Dynamische Tarife",
  "description": "JSON-Schema für den Abruf dynamischer Tarife",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "start_timestamp": {
        "description": "Start-Zeitpunkt des Tarif-Intervalls",
        "type": "string"
      },
      "end_timestamp": {
        "description": "End-Zeitpunkt des Tarif-Intervalls",
        "type": "string"
      },
      "integrated": {
        "description": "Liste der Tarife im Intervall",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "component": {
              "description": "Der optionale Tarif-Name",
              "type": "string"
            },
            "unit": {
              "description": "Die Einheit des Tarif-Preises",
              "type": "string"
            },
            "value": {
              "description": "Der Tarif-Preis",
              "type": "number"
            }
          },
          "propertyNames": {
            "type": "string",
            "pattern": "^(component|unit|value)$"
          },
          "required": [
            "unit",
            "value"
          ]
        }
      }
    },
    "propertyNames": {
      "type": "string",
      "pattern": "^(start_timestamp|end_timestamp|integrated)$"
    },
    "required": [
      "start_timestamp",
      "end_timestamp",
      "integrated"
    ]
  }
}
</pre></font>

                  Ein JSON-Beispiel ist:

<font size="1"><pre style="color:blue">
[
    {
        "start_timestamp": "2025-01-01T00:00:00+01:00",
        "end_timestamp": "2025-01-01T00:15:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.4925
            }
        ]
    },
    {
        "start_timestamp": "2025-01-01T00:15:00+01:00",
        "end_timestamp": "2025-01-01T00:30:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.491133
            }
        ]
    },
    {
        "start_timestamp": "2025-01-01T00:30:00+01:00",
        "end_timestamp": "2025-01-01T00:45:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.486722
            }
        ]
    }
]
</pre></font>
                ]]>
              </textElement>
              <language>de</language>
            </legibleDescription>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>TariffSupply</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <json />
                </dataType>
                <unit>NONE</unit>
                <parameterList>
                  <parameterListElement>
                    <name>start_timestamp</name>
                    <dataType>
                      <string />
                    </dataType>
                    <parameterDescription>
                      <textElement>
                        Begin of tariff periods to be queried. Format according ISO 8601: YYYY-MM-DDThh:mm:ssTZD.
                      </textElement>
                      <language>en</language>
                      <label>Period start time stamp</label>
                    </parameterDescription>
                    <parameterDescription>
                      <textElement>
                        Beginn der abzurufenden Tarifperiode. Format gem. ISO 8601: YYYY-MM-DDThh:mm:ssTZD.
                      </textElement>
                      <language>de</language>
                      <label>Start-Zeitpunkt Periode</label>
                    </parameterDescription>
                  </parameterListElement>
                  <parameterListElement>
                    <name>end_timestamp</name>
                    <dataType>
                      <string />
                    </dataType>
                    <parameterDescription>
                      <textElement>
                        End of tariff periods to be queried. Format according ISO 8601: YYYY-MM-DDThh:mm:ssTZD.
                      </textElement>
                      <language>en</language>
                      <label>Period end time stamp</label>
                    </parameterDescription>
                    <parameterDescription>
                      <textElement>
                        Ende der abzurufenden Tarifperiode. Format gem. ISO 8601: YYYY-MM-DDThh:mm:ssTZD.
                      </textElement>
                      <language>de</language>
                      <label>End-Zeitpunkt Periode</label>
                    </parameterDescription>
                  </parameterListElement>
                </parameterList>
                <legibleDescription>
                  <textElement>
                    <![CDATA[
                      <p>Tariff list - description see above</p>
                      Parameters are
                      <ul>
                        <li><strong>start_timestamp</strong> - ISO8601 date/time - the start time stamp of the requested interval</li>
                        <li><strong>end_timestamp</strong> - ISO8601 date/time - the end time stamp of the requested interval</li>
                      </ul>
                      The JMES queries for the elements of the result structure are:
                      <ul>
                        <li><strong>start_timestamp</strong>:     <span style="color:blue">[*].start_timestamp</span>
                            <br>start time stamp of this interval</li>
                        <li><strong>end_timestamp</strong>:       <span style="color:blue">[*].end_timestamp</span>
                            <br>end time stamp of this interval</li>
                        <li><strong>component</strong>:   <span style="color:blue">[*].integrated[*].component</span>
                            <br>optional name of the tariff</li>
                        <li><strong>unit</strong>: <span style="color:blue">[*].integrated[*].unit</span>
                            <br>unit for the tariff</li>
                        <li><strong>value</strong>:   <span style="color:blue">[*].integrated[*].value</span>
                            <br>price for the tariff</li>
                      </ul>
                    ]]>
                  </textElement>
                  <language>en</language>
                </legibleDescription>
                <legibleDescription>
                  <textElement>
                    <![CDATA[
                      <p>Tarif-Liste - Beschreibung siehe oben</p>
                      Parameter sind
                      <ul>
                        <li><strong>start_timestamp</strong> - ISO8601 date/time - Start-Zeitpunkt des abzufragenden Intervalls</li>
                        <li><strong>end_timestamp</strong> - ISO8601 date/time - End-Zeitpunkt des abzufragenden Intervalls</li>
                      </ul>
                      Die JMES-Queries der einzelnen Elemente der Ausgabe-Datenstruktur sind:
                      <ul>
                        <li><strong>start_timestamp</strong>:     <span style="color:blue">[*].start_timestamp</span>
                            <br>Start-Zeitpunkt des Intervalls</li>
                        <li><strong>end_timestamp</strong>:       <span style="color:blue">[*].end_timestamp</span>
                            <br>End-Zeitpunkt des Intervalls</li>
                        <li><strong>component</strong>:   <span style="color:blue">[*].integrated[*].component</span>
                            <br>Optionaler Name des Tarifs</li>
                        <li><strong>unit</strong>: <span style="color:blue">[*].integrated[*].unit</span>
                            <br>Einheit des Tarifs</li>
                        <li><strong>value</strong>:   <span style="color:blue">[*].integrated[*].value</span>
                            <br>Preis des Tarifs</li>
                      </ul>
                    ]]>
                  </textElement>
                  <language>de</language>
                </legibleDescription>
                <programmerHints>
                  <textElement>
                    <![CDATA[
                      <p>Maps the <code>{{tariff_type}}</code> property to match the <code>integrated</code> property required by SGr.</p>
                      <p>The <code>component</code> property is not supported.</p>
                    ]]>
                  </textElement>
                  <language>en</language>
                </programmerHints>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_object</dataType>
                <restApiReadServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/api/v1/netzinformationen/energie/dynamische-preise</requestPath>
                  <requestQuery>
                    <parameter>
                      <name>start_timestamp</name>
                      <value>[[start_timestamp]]</value>
                    </parameter>
                    <parameter>
                      <name>end_timestamp</name>
                      <value>[[end_timestamp]]</value>
                    </parameter>
                  </requestQuery>
                  <responseQuery>
                    <queryType>JMESPathMapping</queryType>
                    <jmesPathMappings>
                      <mapping>
                        <from>[*].start_timestamp</from>
                        <to>[*].start_timestamp</to>
                      </mapping>
                      <mapping>
                        <from>[*].end_timestamp</from>
                        <to>[*].end_timestamp</to>
                      </mapping>
                      <mapping>
                        <from>[*].{{tariff_type}}[*].value</from>
                        <to>[*].integrated[*].value</to>
                      </mapping>
                      <mapping>
                        <from>[*].{{tariff_type}}[*].unit</from>
                        <to>[*].integrated[*].unit</to>
                      </mapping>
                    </jmesPathMappings>
                  </responseQuery>
                </restApiReadServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
      </functionalProfileList>
    </restApiInterface>
  </interfaceList>
</DeviceFrame>