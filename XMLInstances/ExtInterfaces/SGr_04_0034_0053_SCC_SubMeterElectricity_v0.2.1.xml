<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/SGr.xsl"?>
<RestApiDeviceFrame deviceName="Smart Charge Controller" isLocalControl="true" specificationOwnerIdentification="0" manufacturerName="A. Lehmann Elektro AG"
  xmlns="http://www.smartgridready.com/ns/V0/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.smartgridready.com/ns/V0/ ../../SchemaDatabase/SGr/EI-RestAPI/SGrRestAPI_EIDeviceFrame.xsd ">
    <!-- TODO: broken XML, this EI needs fixing... -->
  <releaseNotes>
    <state>Draft</state>
  </releaseNotes>
  <deviceInformation>
    <transportService>RESTfulJSON</transportService>
    <deviceCategory>SubMeterElectricity</deviceCategory>
    <softwareRevision>0.0.0</softwareRevision>
  </deviceInformation>
  <restApiInterfaceDescription>
    <restApiInterfaceSelection>URI</restApiInterfaceSelection>
    <restApiUri>https://api.smartchargecontroller.ch:3000</restApiUri>
    <restApiAuthenticationMethod>BearerSecurityScheme</restApiAuthenticationMethod>
    <restApiBearer>
      <restServiceCall>
        <requestHeader>
          <header headerName="Accept" value="application/json"/>
        </requestHeader>
        <requestMethod>POST</requestMethod>
        <requestPath>/auth/login</requestPath>
        <requestBody>{"username": "{{username}}", "password": "{{password}}" }</requestBody>
        <responseQuery>
          <queryType>JMESPathExpression</queryType>
          <query>accessToken</query>
        </responseQuery>
      </restServiceCall>
    </restApiBearer>
  </restApiInterfaceDescription>
  <functionalProfileListElement>
    <functionalProfile profileName="ActivePowerAC">
      <functionalProfileIdentification>
        <specificationOwnerIdentification>0</specificationOwnerIdentification>
        <functionalProfileCategory>NonSpecific</functionalProfileCategory>
        <functionalProfileType>ActivePowerAC</functionalProfileType>
        <levelOfOperation>m</levelOfOperation>
        <versionNumber>
          <primaryVersionNumber>1</primaryVersionNumber>
          <secondaryVersionNumber>0</secondaryVersionNumber>
          <subReleaseVersionNumber>0</subReleaseVersionNumber>
        </versionNumber>
      </functionalProfileIdentification>
    </functionalProfile>
    <dataPointListElement>
      <dataPoint datapointName="ActivePowerACtot" presenceLevel="R" dataDirection="R" unit="WATTS">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>sum([activePower.l1,activePower.l2,activePower.l3])</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
    <dataPointListElement>
      <dataPoint datapointName="ActivePowerACL1" presenceLevel="R" dataDirection="R" unit="WATTS">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>activePower.l1</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
    <dataPointListElement>
      <dataPoint datapointName="ActivePowerACL2" presenceLevel="R" dataDirection="R" unit="WATTS">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>activePower.l2</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
    <dataPointListElement>
      <dataPoint datapointName="ActivePowerACL3" presenceLevel="R" dataDirection="R" unit="WATTS">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>activePower.l3</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
  </functionalProfileListElement>
  <functionalProfileListElement>
    <functionalProfile profileName="VoltageAC">
      <functionalProfileIdentification>
        <specificationOwnerIdentification>0</specificationOwnerIdentification>
        <functionalProfileCategory>NonSpecific</functionalProfileCategory>
        <functionalProfileType>VoltageAC</functionalProfileType>
        <levelOfOperation>4</levelOfOperation>
        <versionNumber>
          <primaryVersionNumber>0</primaryVersionNumber>
          <secondaryVersionNumber>1</secondaryVersionNumber>
          <subReleaseVersionNumber>1</subReleaseVersionNumber>
        </versionNumber>
      </functionalProfileIdentification>
    </functionalProfile>
    <dataPointListElement>
      <dataPoint datapointName="VoltageACL1_N" presenceLevel="R" dataDirection="R" unit="VOLTS">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>voltage.l1</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
    <dataPointListElement>
      <dataPoint datapointName="VoltageACL2_N" presenceLevel="R" dataDirection="R" unit="VOLTS">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>voltage.l2</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
    <dataPointListElement>
      <dataPoint datapointName="VoltageACL3_N" presenceLevel="R" dataDirection="R" unit="VOLTS">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>voltage.l3</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
  </functionalProfileListElement>
  <functionalProfileListElement>
    <functionalProfile profileName="CurrentAC">
      <functionalProfileIdentification>
        <specificationOwnerIdentification>0</specificationOwnerIdentification>
        <functionalProfileCategory>NonSpecific</functionalProfileCategory>
        <functionalProfileType>CurrentAC</functionalProfileType>
        <levelOfOperation>m</levelOfOperation>
        <versionNumber>
          <primaryVersionNumber>1</primaryVersionNumber>
          <secondaryVersionNumber>0</secondaryVersionNumber>
          <subReleaseVersionNumber>0</subReleaseVersionNumber>
        </versionNumber>
      </functionalProfileIdentification>
    </functionalProfile>
    <dataPointListElement>
      <dataPoint datapointName="CurrentACL1" presenceLevel="M" dataDirection="R" unit="AMPERES">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>current.l1</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
    <dataPointListElement>
      <dataPoint datapointName="CurrentACL2" presenceLevel="R" dataDirection="R" unit="AMPERES">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>current.l2</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
    <dataPointListElement>
      <dataPoint datapointName="CurrentACL3" presenceLevel="R" dataDirection="R" unit="AMPERES">
        <dataType>
          <float64/>
        </dataType>
      </dataPoint>
      <genericAttributes>
        <measuredValueSource>measuredValue</measuredValueSource>
        <sampleRateHz>10</sampleRateHz>
      </genericAttributes>
      <restApiDataPointConfiguration dataType="JSON_number">
        <restServiceCall>
          <requestHeader>
            <header headerName="Accept" value="application/json"/>
          </requestHeader>
          <requestMethod>GET</requestMethod>
          <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
          <responseQuery>
            <queryType>JMESPathExpression</queryType>
            <query>current.l3</query>
          </responseQuery>
        </restServiceCall>
      </restApiDataPointConfiguration>
    </dataPointListElement>
  </functionalProfileListElement>
</RestApiDeviceFrame>