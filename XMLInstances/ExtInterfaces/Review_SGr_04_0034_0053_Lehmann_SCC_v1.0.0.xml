<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/SGr.xsl"?>
<DeviceFrame xmlns="http://www.smartgridready.com/ns/V0/"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.smartgridready.com/ns/V0/ ../../SchemaDatabase/SGr/Product/Product.xsd">
  <deviceName>Smart Charge Controller</deviceName>
  <manufacturerName>A. Lehmann Elektro AG</manufacturerName>
  <specificationOwnerIdentification>0</specificationOwnerIdentification>
  <releaseNotes>
    <state>Draft</state>
  </releaseNotes>
  <deviceInformation>
    <deviceCategory>SubMeterElectricity</deviceCategory>
    <isLocalControl>true</isLocalControl>
    <softwareRevision>1.0.0</softwareRevision>
    <hardwareRevision>1.0.0</hardwareRevision>
    <levelOfOperation>m</levelOfOperation>
  </deviceInformation>
  <interfaceList>
    <restApiInterface>
      <restApiInterfaceDescription>
        <restApiInterfaceSelection>URI</restApiInterfaceSelection>
        <restApiUri>https://api.smartchargecontroller.ch:3000</restApiUri>
        <restApiAuthenticationMethod>BearerSecurityScheme</restApiAuthenticationMethod>
        <restApiBearer>
          <restApiServiceCall>
            <requestHeader>
              <header>
                <headerName>Accept</headerName>
                <value>application/json</value>
              </header>
            </requestHeader>
            <requestMethod>POST</requestMethod>
            <requestPath>/auth/login</requestPath>
            <requestBody>{"username": "{{username}}", "password": "{{password}}" }</requestBody>
            <responseQuery>
              <queryType>JMESPathExpression</queryType>
              <query>accessToken</query>
            </responseQuery>
          </restApiServiceCall>
        </restApiBearer>
      </restApiInterfaceDescription>
      <functionalProfileList>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>ActivePowerAC</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>Metering</functionalProfileCategory>
              <functionalProfileType>ActivePowerAC</functionalProfileType>
              <levelOfOperation>m</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>1</primaryVersionNumber>
                <secondaryVersionNumber>0</secondaryVersionNumber>
                <subReleaseVersionNumber>0</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
            <legibleDescription>
              <textElement>
                <![CDATA[	
                  <img src="ressources/fp_product_to_cem.svg" style="float:left; padding:0.3em;"/>
                  <strong>Messung der Wirkleistung</strong><br>
                  Monitoring Funktionsprofil für Stromerzeuger und Stromverbraucher zur Kontrolle der Systemlast und/oder für regeltechnische 
                  Zwecke.
                  
                  <p>Für Regelzwecke ist die Kenntnissder Messgenauigkeit zwingend und wird daher pro Datenpunkt als obligatorisches
                     Attribut angegeben. Somit ist es möglich unterschiedliche Messgenauigkeiten für die Datenpunkte
                     zu definieren.</p>
                  
                  <p>Dieses Funktionsprofil erlaubt sowohl die Messung der Totalleistung wie auch die Leistung der drei
                     einzelnen Phasen. Eine der folgenden Varianten muss bei der Implementierung des Funktionsprofiles
                     umgesetzt werden:
                  <ul>
                    <li>Einphasige Geräte geben die Totalleistung an (ActivePowerACtot)</li>
                    <li>3-phasige Geräte ohne Totalleistungsmessung geben die Leistung pro Phase an (ActivePowerACL1, ActivePowerACL2, ActivePowerACL3)</li>
                    <li>3-phasige Geräte mit Einzelphasen- und Totalleistungsmessung geben alle Datenpunkte an</li>
                  </ul>
                  </p>
                ]]>
              </textElement>
              <language>de</language>
            </legibleDescription>
            <legibleDescription>
              <textElement>
                <![CDATA[	
                  <img src="ressources/fp_product_to_cem.svg" style="float:left; padding:0.3em;"/>
                  <strong>Active Power Measurement</strong><br>
                  Monitoring functional profile for power generators and consumers for reflecting the active power.
                  
                  <p>Knowing the precisionPercent of measurements is necessary and therefore specified as a mandatory attribute
                     per data point. Thus, different measurement precisions can be defined for the data points.</p>
                  
                  <p>With this functional profile you can measure the total active power as well as the active power of
                     the three individual phases. One of the following options must be implemented for fulfilling the functional profile:
                  <ul>
                    <li>Single-phase devices use the total active power data point (ActivePowerACtot)</li>
                    <li>Three-phase devices without measurement of the total active power use the data points per phase (ActivePowerACL1, ActivePowerACL2, ActivePowerACL3)</li>
                    <li>Three-phase devices with measurement of the total active power use all data points</li>
                  </ul>
                  </p>
                ]]>			
              </textElement>
              <language>en</language>
            </legibleDescription>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ActivePowerACtot</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>WATTS</unit>
                <unit>KILOWATTS</unit>
                <legibleDescription>
                  <textElement>Erfassung der gesamten Wirkleistung</textElement>
                  <language>de</language>
                </legibleDescription>
                <legibleDescription>
                  <textElement>Total active power measurement</textElement>
                  <language>en</language>
                </legibleDescription>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>multiply(`0.001`,sum([activePower.l1,activePower.l2,activePower.l3]))</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ActivePowerACL1</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>WATTS</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>activePower.l1</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ActivePowerACL2</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>WATTS</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>activePower.l2</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ActivePowerACL3</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>WATTS</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>activePower.l3</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>VoltageAC</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>Metering</functionalProfileCategory>
              <functionalProfileType>VoltageAC</functionalProfileType>
              <levelOfOperation>4</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>0</primaryVersionNumber>
                <secondaryVersionNumber>1</secondaryVersionNumber>
                <subReleaseVersionNumber>1</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>VoltageACL1_N</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>VOLTS</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>voltage.l1</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>VoltageACL2_N</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>VOLTS</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>voltage.l2</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>VoltageACL3_N</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>VOLTS</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>voltage.l3</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>CurrentAC</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>Metering</functionalProfileCategory>
              <functionalProfileType>CurrentAC</functionalProfileType>
              <levelOfOperation>m</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>1</primaryVersionNumber>
                <secondaryVersionNumber>0</secondaryVersionNumber>
                <subReleaseVersionNumber>0</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>CurrentACL1</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>AMPERES</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>current.l1</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>CurrentACL2</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>AMPERES</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>current.l2</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>CurrentACL3</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <float64 />
                </dataType>
                <unit>AMPERES</unit>
              </dataPoint>
              <genericAttributeList>
                <genericAttributeListElement>
                  <name>SampleRate</name>
                  <dataType>
                    <int64U/>
                  </dataType>
                  <value>10</value>
                  <unit>HERTZ</unit>
                </genericAttributeListElement>
              </genericAttributeList>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/edges/{{edgeid}}/metrics/momentaryMeterValues</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>current.l3</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
      </functionalProfileList>
    </restApiInterface>
  </interfaceList>
</DeviceFrame>