<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/SGr.xsl"?>
<DeviceFrame xmlns="http://www.smartgridready.com/ns/V0/"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.smartgridready.com/ns/V0/ ../../SchemaDatabase/SGr/Product/Product.xsd">
  <deviceName>EKZ Dynamic Tariffs</deviceName>
  <manufacturerName>EKZ</manufacturerName>
  <specificationOwnerIdentification>0</specificationOwnerIdentification>
  <releaseNotes>
    <state>Draft</state>
    <changeLog>
      <version>0.1.0</version>
      <date>2025-10-13</date>
      <author>SGr/mkr</author>
      <comment>Initial draft</comment>
    </changeLog>
    <changeLog>
      <version>0.1.1</version>
      <date>2025-11-24</date>
      <author>SGr/mkr</author>
      <comment>use JSONata query</comment>
    </changeLog>
    <changeLog>
      <version>0.1.2</version>
      <date>2026-02-04</date>
      <author>SGr/mkr</author>
      <comment>changed category/type/level</comment>
    </changeLog>
  </releaseNotes>
  <deviceInformation>
    <legibleDescription>
      <textElement>
        <![CDATA[
          <p>EKZ's dynamic tariff consists of a dynamic energy tariff and a dynamic grid usage tariff.
          The energy tariff and the grid usage tariff can change every 15 minutes, depending on the current electricity market price and grid utilization.
          These two tariff components are calculated according to the same pattern and published daily.</p>
          <p>Additional information on the tariffs can be found <a href="https://www.ekz.ch/de/ueber-ekz/unternehmen/ekz/gesetzliche-vorgaben.html">here</a>.</p>

          <p>Who is the dynamic tariff suitable for?</p>
          <p>The dynamic tariff is aimed at private and business customers with an annual consumption of less than 100,000 kWh.
          It is particularly worthwhile for households and businesses that have large electricity consumers such as electric cars, heat pumps, boilers, or batteries and can control their consumption flexibly and automatically via an energy management system.</p>
          <p>How does the dynamic tariff work?</p>
          <p>With the dynamic tariff, the energy tariff and the grid usage tariff can change every 15 minutes, depending on the current electricity market price and the utilization of the grid.</p>

          <p>These two tariff components change continuously:</p>
          <ul>
            <li>EKZ Energie Dynamisch: Tariff is based on the spot market</li>
            <li>EKZ Netz 400D: Tariff is based on current grid utilization</li>
          </ul>
          <p>This protects you from sharp fluctuations:</p>
          <p>The energy tariff may deviate by a maximum of ±5 cents/kWh from the standard tariff (EKZ Renewable Energy).</p>
          <p>The grid usage tariff may be up to 5 cents/kWh below or up to 15 cents/kWh above the standard grid usage tariff (EKZ Grid 400ST).</p>
          <p>With automatically controlled consumption (via EMS), you can make targeted use of times with favorable rates. This means that the average daily price can be lower than the standard rate.
          Without proper control, however, consumption may fall into expensive time slots and your overall electricity costs may be higher.</p>
          <p>As with all EKZ tariffs, statutory levies and surcharges are also charged.</p>

          <ul>
            <li><strong>Data Update Frequency:</strong>&nbsp;Day-ahead</li>
            <li><strong>Time of Publication:</strong>&nbsp;18:00 on the day before</li>
            <li><strong>Binding Character:</strong>&nbsp;Adjustments can be made until the end of the previous day. If the EKZ API is not available by midnight on the previous day, the standard rate applies. This applies exclusively to the EKZ systems; end customers are responsible for receiving and processing the rate information.</li>
            <li><strong>Non-dynamic Elements:</strong>&nbsp;Basic energy rate, metering rate and additional fees</li>
          </ul>
        ]]>
      </textElement>
      <language>en</language>
      <uri>https://www.ekz.ch/de/privatkunden/strom/tarife/dynamischer-wahltarif.html</uri>
    </legibleDescription>
    <legibleDescription>
      <textElement>
        <![CDATA[
          <p>Der dynamische Tarif von EKZ setzt sich aus einem dynamischen Energie- und einem dynamischen Netznutzungstarif zusammen.
          Der Energietarif und der Netznutzungstarif können dabei alle 15 Minuten ändern, abhängig vom aktuellen Strommarktpreis und der Auslastung des Netzes.
          Diese beiden Tarifkomponenten werden nach demselben Muster berechnet und täglich neu veröffentlicht.</p>
          <p>Weitere Infos zu den Tarifen sind <a href="https://www.ekz.ch/de/ueber-ekz/unternehmen/ekz/gesetzliche-vorgaben.html">hier</a> zu finden.</p>

          <p>Für wen eignet sich der dynamische Tarif?</p>
          <p>Der dynamische Tarif richtet sich an Privat- und Geschäftskunden mit einem Jahresverbrauch unter 100'000 kWh.
          Er lohnt sich besonders für Haushalte und Betriebe, die grosse Stromverbraucher wie Elektroauto, Wärmepumpe, Boiler oder Batterie besitzen und ihren Verbrauch flexibel und automatisch über ein Energiemanagementsystem steuern lassen können.</p>
          <p>Wie funktioniert der dynamische Tarif?</p>
          <p>Beim dynamischen Tarif können sich der Energietarif und der Netznutzungstarif alle 15 Minuten ändern, abhängig vom aktuellen Strommarktpreis und der Auslastung des Netzes.</p>

          <p>Diese beiden Tarifbestandteile ändern sich laufend:</p>
          <ul>
            <li>EKZ Energie Dynamisch: Tarif richtet sich nach dem Spotmarkt</li>
            <li>EKZ Netz 400D: Tarif richtet sich nach der aktuellen Netzauslastung</li>
          </ul>
          <p>So sind Sie vor starken Schwankungen geschützt:</p>
          <p>Der Energietarif kann maximal ±5 Rp./kWh vom Standardtarif (EKZ Energie Erneuerbar) abweichen.</p>
          <p>Der Netznutzungstarif kann bis zu 5 Rp./kWh unter oder bis zu 15 Rp./kWh über dem Standardnetznutzungstarif (EKZ Netz 400ST) liegen.</p>
          <p>Mit einem automatisch gesteuerten Verbrauch (über EMS) können Sie gezielt Zeiten mit günstigen Tarifen nutzen. So kann der durchschnittliche Tagespreis tiefer liegen als im Standardtarif.
          Ohne eine korrekte Steuerung hingegen kann der Verbrauch in teure Zeitfenster fallen und Ihre Stromkosten insgesamt höher ausfallen.</p>
          <p>Wie bei allen EKZ-Tarifen werden zusätzlich die gesetzlichen Abgaben und Zuschläge verrechnet.</p>

          <ul>
            <li><strong>Häufigkeit der Datenaktualisierung:</strong>&nbsp;Day-ahead</li>
            <li><strong>Publikationszeitpunkt:</strong>&nbsp;18:00 Uhr am Vortag</li>
            <li><strong>Verbindlichkeit:</strong>&nbsp;Anpassungen sind bis zum Ende des Vortages möglich. Sofern die API von EKZ bis 24.00 Uhr am Vortag nicht verfügbar ist, gilt der Standardtarif. Dies gilt ausschliesslich für den Teil der EKZ-Systeme; für den Empfang und die Verarbeitung der Tarifinformationen sind die Endkunden verantwortlich.</li>
            <li><strong>Nicht-dynamische Elemente:</strong>&nbsp;Grundtarif Energie, Messtarif sowie Zuschläge und Abgaben</li>
          </ul>
        ]]>
      </textElement>
      <language>de</language>
      <uri>https://www.ekz.ch/de/privatkunden/strom/tarife/dynamischer-wahltarif.html</uri>
    </legibleDescription>
    <deviceCategory>SGCP</deviceCategory>
    <isLocalControl>false</isLocalControl>
    <softwareRevision>1.0.0</softwareRevision>
    <hardwareRevision>-</hardwareRevision>
    <manufacturerSpecificationIdentification>EKZDynamicTariffs</manufacturerSpecificationIdentification>
    <levelOfOperation>m</levelOfOperation>
    <versionNumber>
      <primaryVersionNumber>0</primaryVersionNumber>
      <secondaryVersionNumber>1</secondaryVersionNumber>
      <subReleaseVersionNumber>2</subReleaseVersionNumber>
    </versionNumber>
    <testState>Verified</testState>
    <programmerHints>
      <textElement>
        <![CDATA[
          <p>Link zur technischen Dokumentation:</p>
        ]]>
      </textElement>
      <language>de</language>
      <uri>https://www.ekz.ch/dam/ekz/privatkunden/strom/tarife-und-agb/Tarifdokumente/tarife-2026/EKZ_Dynamischer-Tarif-2026_technischer-Beschrieb.pdf</uri>
    </programmerHints>
  </deviceInformation>
  <interfaceList>
    <restApiInterface>
      <restApiInterfaceDescription>
        <restApiInterfaceSelection>URI</restApiInterfaceSelection>
        <restApiUri>https://api.tariffs.ekz.ch</restApiUri>
        <restApiAuthenticationMethod>NoSecurityScheme</restApiAuthenticationMethod>
      </restApiInterfaceDescription>
      <functionalProfileList>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>DynamicTariff</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>SGCP</functionalProfileCategory>
              <functionalProfileType>DynamicTariff</functionalProfileType>
              <levelOfOperation>m</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>1</primaryVersionNumber>
                <secondaryVersionNumber>0</secondaryVersionNumber>
                <subReleaseVersionNumber>0</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
            <legibleDescription>
              <textElement>
                <![CDATA[
                  The dynamic tariff structure offers a price that can change every 15 minutes.
                  <p>The functional profile contains all the necessary information to retrieve a series of data points with information on tariff values every 15 minutes.</p>
                  <p>The prices are available on an online interface (WEB-API), which an energy management system will use to plan the operation of various devices.</p>
                  <p><img src="ressources/dynamic_tariff.svg"/></p>
                  <p>This functional profile can only be provided by products with REST API interface.</p>
                  <p>The request for the tariffs defines the start time stamp and end time stamp of the interval the tariffs should be returned for.
                  Each entry in the resulting tariff list contains also the start time stamp and end time stamp of the sub intervals together with a list of entries with tariff unit and tariff value.</p>

                  The schema for the JSON created by the REST API is

<font size="1"><pre style="color:blue">
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Dynamic Tariffs",
  "description": "JSON schema for the delivery of tariffs",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "start_timestamp": {
        "description": "Start time stamp of the tariff interval",
        "type": "string"
      },
      "end_timestamp": {
        "description": "End time stamp of the tariff interval",
        "type": "string"
      },
      "integrated": {
        "description": "List of tariffs in that interval",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "component": {
              "description": "The optional name of the tariff",
              "type": "string"
            },
            "unit": {
              "description": "The tariff unit for the price",
              "type": "string"
            },
            "value": {
              "description": "The tariff price value",
              "type": "number"
            }
          },
          "propertyNames": {
            "type": "string",
            "pattern": "^(component|unit|value)$"
          },
          "required": [
            "unit",
            "value"
          ]
        }
      }
    },
    "propertyNames": {
      "type": "string",
      "pattern": "^(start_timestamp|end_timestamp|integrated)$"
    },
    "required": [
      "start_timestamp",
      "end_timestamp",
      "integrated"
    ]
  }
}
</pre></font>

          An example JSON is:

<font size="1"><pre style="color:blue">
[
    {
        "start_timestamp": "2025-01-01T00:00:00+01:00",
        "end_timestamp": "2025-01-01T00:15:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.4925
            }
        ]
    },
    {
        "start_timestamp": "2025-01-01T00:15:00+01:00",
        "end_timestamp": "2025-01-01T00:30:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.491133
            }
        ]
    },
    {
        "start_timestamp": "2025-01-01T00:30:00+01:00",
        "end_timestamp": "2025-01-01T00:45:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.486722
            }
        ]
    }
]
</pre></font>
                ]]>
              </textElement>
              <language>en</language>
            </legibleDescription>
            <legibleDescription>
              <textElement>
                <![CDATA[
                  Die dynamische Tarif-Struktur bietet einen Strompreis, der sich alle 15 Minuten ändern kann.</p>
                  <p>Das Funktionsprofil enthält alle nötigen Informationen, um eine Reihe von Datenpunkten mit Tarifinformationen alle 15 Minuten abzufragen.</p>
                  <p>Die Preise sind über ein Online-Interface (WEB-API) abrufbar, womit ein Energie-Management-System den Betrieb verschiedener Geräte zeitlich festlegt.</p>
                  <p><img src="ressources/dynamic_tariff.svg"/></p>
                  <p>Dieses Funktionsprofil kann nur mit Produkten genutzt werden, die ein REST API unterstützen.</p>
                  <p>Die Tarif-Abfrage definiert den Start- und End-Zeitpunkt des Intervalls, für das die Tarife abgerufen werden.
                      Jedes Element der resultierenden Tarif-Liste enthält auch den Start- und End-Zeitpunkt der Sub-Intervalle, in Kombination mit einer Liste von Elementen mit Tarif-Einheit und -Preis.</p>

                  Das JSON-Schema des REST API ist

<font size="1"><pre style="color:blue">
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Dynamische Tarife",
  "description": "JSON-Schema für den Abruf dynamischer Tarife",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "start_timestamp": {
        "description": "Start-Zeitpunkt des Tarif-Intervalls",
        "type": "string"
      },
      "end_timestamp": {
        "description": "End-Zeitpunkt des Tarif-Intervalls",
        "type": "string"
      },
      "integrated": {
        "description": "Liste der Tarife im Intervall",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "component": {
              "description": "Der optionale Tarif-Name",
              "type": "string"
            },
            "unit": {
              "description": "Die Einheit des Tarif-Preises",
              "type": "string"
            },
            "value": {
              "description": "Der Tarif-Preis",
              "type": "number"
            }
          },
          "propertyNames": {
            "type": "string",
            "pattern": "^(component|unit|value)$"
          },
          "required": [
            "unit",
            "value"
          ]
        }
      }
    },
    "propertyNames": {
      "type": "string",
      "pattern": "^(start_timestamp|end_timestamp|integrated)$"
    },
    "required": [
      "start_timestamp",
      "end_timestamp",
      "integrated"
    ]
  }
}
</pre></font>

                  Ein JSON-Beispiel ist:

<font size="1"><pre style="color:blue">
[
    {
        "start_timestamp": "2025-01-01T00:00:00+01:00",
        "end_timestamp": "2025-01-01T00:15:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.4925
            }
        ]
    },
    {
        "start_timestamp": "2025-01-01T00:15:00+01:00",
        "end_timestamp": "2025-01-01T00:30:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.491133
            }
        ]
    },
    {
        "start_timestamp": "2025-01-01T00:30:00+01:00",
        "end_timestamp": "2025-01-01T00:45:00+01:00",
        "integrated": [
            {
                "component": "work",
                "unit": "CHF/kWh",
                "value": 0.486722
            }
        ]
    }
]
</pre></font>
                ]]>
              </textElement>
              <language>de</language>
            </legibleDescription>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>TariffSupply</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <json />
                </dataType>
                <unit>NONE</unit>
                <parameterList>
                  <parameterListElement>
                    <name>start_timestamp</name>
                    <dataType>
                      <string />
                    </dataType>
                    <parameterDescription>
                      <textElement>
                        Begin of tariff periods to be queried. Format according ISO 8601: YYYY-MM-DDThh:mm:ssTZD.
                      </textElement>
                      <language>en</language>
                      <label>Period start time stamp</label>
                    </parameterDescription>
                    <parameterDescription>
                      <textElement>
                        Beginn der abzurufenden Tarifperiode. Format gem. ISO 8601: YYYY-MM-DDThh:mm:ssTZD.
                      </textElement>
                      <language>de</language>
                      <label>Start-Zeitpunkt Periode</label>
                    </parameterDescription>
                  </parameterListElement>
                  <parameterListElement>
                    <name>end_timestamp</name>
                    <dataType>
                      <string />
                    </dataType>
                    <parameterDescription>
                      <textElement>
                        End of tariff periods to be queried. Format according ISO 8601: YYYY-MM-DDThh:mm:ssTZD.
                      </textElement>
                      <language>en</language>
                      <label>Period end time stamp</label>
                    </parameterDescription>
                    <parameterDescription>
                      <textElement>
                        Ende der abzurufenden Tarifperiode. Format gem. ISO 8601: YYYY-MM-DDThh:mm:ssTZD.
                      </textElement>
                      <language>de</language>
                      <label>End-Zeitpunkt Periode</label>
                    </parameterDescription>
                  </parameterListElement>
                </parameterList>
                <legibleDescription>
                  <textElement>
                    <![CDATA[
                      <p>Tariff list - description see above</p>
                      Parameters are
                      <ul>
                        <li><strong>start_timestamp</strong> - ISO8601 date/time - the start time stamp of the requested interval</li>
                        <li><strong>end_timestamp</strong> - ISO8601 date/time - the end time stamp of the requested interval</li>
                      </ul>
                      The JMES queries for the elements of the result structure are:
                      <ul>
                        <li><strong>start_timestamp</strong>:     <span style="color:blue">[*].start_timestamp</span>
                            <br>start time stamp of this interval</li>
                        <li><strong>end_timestamp</strong>:       <span style="color:blue">[*].end_timestamp</span>
                            <br>end time stamp of this interval</li>
                        <li><strong>component</strong>:   <span style="color:blue">[*].integrated[*].component</span>
                            <br>optional name of the tariff</li>
                        <li><strong>unit</strong>: <span style="color:blue">[*].integrated[*].unit</span>
                            <br>unit for the tariff</li>
                        <li><strong>value</strong>:   <span style="color:blue">[*].integrated[*].value</span>
                            <br>price for the tariff</li>
                      </ul>
                    ]]>
                  </textElement>
                  <language>en</language>
                </legibleDescription>
                <legibleDescription>
                  <textElement>
                    <![CDATA[
                      <p>Tarif-Liste - Beschreibung siehe oben</p>
                      Parameter sind
                      <ul>
                        <li><strong>start_timestamp</strong> - ISO8601 date/time - Start-Zeitpunkt des abzufragenden Intervalls</li>
                        <li><strong>end_timestamp</strong> - ISO8601 date/time - End-Zeitpunkt des abzufragenden Intervalls</li>
                      </ul>
                      Die JMES-Queries der einzelnen Elemente der Ausgabe-Datenstruktur sind:
                      <ul>
                        <li><strong>start_timestamp</strong>:     <span style="color:blue">[*].start_timestamp</span>
                            <br>Start-Zeitpunkt des Intervalls</li>
                        <li><strong>end_timestamp</strong>:       <span style="color:blue">[*].end_timestamp</span>
                            <br>End-Zeitpunkt des Intervalls</li>
                        <li><strong>component</strong>:   <span style="color:blue">[*].integrated[*].component</span>
                            <br>Optionaler Name des Tarifs</li>
                        <li><strong>unit</strong>: <span style="color:blue">[*].integrated[*].unit</span>
                            <br>Einheit des Tarifs</li>
                        <li><strong>value</strong>:   <span style="color:blue">[*].integrated[*].value</span>
                            <br>Preis des Tarifs</li>
                      </ul>
                    ]]>
                  </textElement>
                  <language>de</language>
                </legibleDescription>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_object</dataType>
                <restApiReadServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/v1/tariffs</requestPath>
                  <requestQuery>
                    <parameter>
                      <name>tariff_type</name>
                      <value>integrated</value>
                    </parameter>
                    <parameter>
                      <name>start_timestamp</name>
                      <value>[[start_timestamp]]</value>
                    </parameter>
                    <parameter>
                      <name>end_timestamp</name>
                      <value>[[end_timestamp]]</value>
                    </parameter>
                  </requestQuery>
                  <responseQuery>
                    <queryType>JSONataExpression</queryType>
                    <query>
                      <![CDATA[
                        prices[].{
                          "start_timestamp": start_timestamp,
                          "end_timestamp": end_timestamp,
                          "integrated": integrated[].{
                            "value": value,
                            "unit": unit
                          }
                        }
                      ]]>
                    </query>
                  </responseQuery>
                </restApiReadServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
      </functionalProfileList>
    </restApiInterface>
  </interfaceList>
</DeviceFrame>