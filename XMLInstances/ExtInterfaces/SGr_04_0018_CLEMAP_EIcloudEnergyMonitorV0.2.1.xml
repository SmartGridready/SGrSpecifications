<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/SGr.xsl"?>
<RestApiDeviceFrame xmlns="http://www.smartgridready.com/ns/V0/"
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                    xsi:schemaLocation="http://www.smartgridready.com/ns/V0/ ../../SchemaDatabase/SGr/EI-RestAPI/SGrRestAPI_EIDeviceFrame.xsd ">
  <deviceName>CLEMAP Energy Monitor</deviceName>
  <manufacturerName>CLEMAP</manufacturerName>
  <specificationOwnerIdentification>0</specificationOwnerIdentification>
  <releaseNotes>
    <state>Draft</state>
  </releaseNotes>
  <deviceInformation>
    <transportService>RESTfulJSON</transportService>
    <deviceCategory>SubMeterElectricity</deviceCategory>
    <isLocalControl>false</isLocalControl>
    <softwareRevision>1.0.0</softwareRevision>
    <manufacturerSpecificationIdentification>CLEMAP</manufacturerSpecificationIdentification>
  </deviceInformation>
  <restApiInterfaceDescription>
    <restApiInterfaceSelection>URI</restApiInterfaceSelection>
    <restApiUri>{{baseUri}}</restApiUri>
    <restApiAuthenticationMethod>BearerSecurityScheme</restApiAuthenticationMethod>
    <restApiBearer>
      <requestHeader>
        <header>
          <headerName>Accept</headerName>
          <value>application/json</value>
        </header>
      </requestHeader>
      <requestMethod>POST</requestMethod>
      <requestPath>/authentication</requestPath>
      <requestBody>{"strategy": "local", "email": "{{username}}", "password": "{{password}}"}</requestBody>
      <responseQuery>
        <queryType>JMESPathExpression</queryType>
        <query>accessToken</query>
      </responseQuery>
    </restApiBearer>
  </restApiInterfaceDescription>
  <functionalProfileList>
    <functionalProfileListElement>
      <functionalProfile>
        <functionalProfileName>ActivePowerAC</functionalProfileName>
        <functionalProfileIdentification>
          <specificationOwnerIdentification>0</specificationOwnerIdentification>
          <functionalProfileCategory>NonSpecific</functionalProfileCategory>
          <functionalProfileType>ActivePowerAC</functionalProfileType>
          <levelOfOperation>m</levelOfOperation>
          <versionNumber>
            <primaryVersionNumber>1</primaryVersionNumber>
            <secondaryVersionNumber>0</secondaryVersionNumber>
            <subReleaseVersionNumber>0</subReleaseVersionNumber>
          </versionNumber>
        </functionalProfileIdentification>
      </functionalProfile>
      <dataPointList>
        <dataPointListElement>
          <dataPoint>
            <dataPointName>ActivePowerACtot</dataPointName>
            <dataDirection>R</dataDirection>
            <presenceLevel>R</presenceLevel>
            <dataType>
              <float64/>
            </dataType>
            <unit>KILOWATTS</unit>
          </dataPoint>
          <restApiDataPointConfiguration>
            <dataType>JSON_number</dataType>
            <requestHeader>
              <header>
                <headerName>Accept</headerName>
                <value>application/json</value>
              </header>
              <header>
                <headerName>Authentication</headerName>
                <value>Bearer {{bearerToken}}</value>
              </header>
            </requestHeader>
            <requestMethod>GET</requestMethod>
            <requestPath>/digitaltwins/?sensor_id={{sensor_id}}</requestPath>
            <responseQuery>
              <queryType>JMESPathExpression</queryType>
              <query>sum([[0].ten_sec.p_l1,[0].ten_sec.p_l2,[0].ten_sec.p_l3])</query>
            </responseQuery>
          </restApiDataPointConfiguration>
        </dataPointListElement>
        <dataPointListElement>
          <dataPoint>
            <dataPointName>ActivePowerACL1</dataPointName>
            <dataDirection>R</dataDirection>
            <presenceLevel>R</presenceLevel>
            <dataType>
              <float64/>
            </dataType>
            <unit>KILOWATTS</unit>
          </dataPoint>
          <restApiDataPointConfiguration>
            <dataType>JSON_number</dataType>
            <requestHeader>
              <header>
                <headerName>Accept</headerName>
                <value>application/json</value>
              </header>
            </requestHeader>
            <requestMethod>GET</requestMethod>
            <requestPath>/digitaltwins/?sensor_id={{sensor_id}}</requestPath>
            <responseQuery>
              <queryType>JMESPathExpression</queryType>
              <query>[0].ten_sec.p_l1</query>
            </responseQuery>
          </restApiDataPointConfiguration>
        </dataPointListElement>
        <dataPointListElement>
          <dataPoint>
            <dataPointName>ActivePowerACL2</dataPointName>
            <dataDirection>R</dataDirection>
            <presenceLevel>R</presenceLevel>
            <dataType>
              <float64/>
            </dataType>
            <unit>KILOWATTS</unit>
          </dataPoint>
          <restApiDataPointConfiguration>
            <dataType>JSON_number</dataType>
            <requestHeader>
              <header>
                <headerName>Accept</headerName>
                <value>application/json</value>
              </header>
            </requestHeader>
            <requestMethod>GET</requestMethod>
            <requestPath>/digitaltwins/?sensor_id={{sensor_id}}</requestPath>
            <responseQuery>
              <queryType>JMESPathExpression</queryType>
              <query>[0].ten_sec.p_l2</query>
            </responseQuery>
          </restApiDataPointConfiguration>
        </dataPointListElement>
        <dataPointListElement>
          <dataPoint>
            <dataPointName>ActivePowerACL3</dataPointName>
            <dataDirection>R</dataDirection>
            <presenceLevel>R</presenceLevel>
            <dataType>
              <float64/>
            </dataType>
            <unit>KILOWATTS</unit>
          </dataPoint>
          <restApiDataPointConfiguration>
            <dataType>JSON_number</dataType>
            <requestHeader>
              <header>
                <headerName>Accept</headerName>
                <value>application/json</value>
              </header>
            </requestHeader>
            <requestMethod>GET</requestMethod>
            <requestPath>/digitaltwins/?sensor_id={{sensor_id}}</requestPath>
            <responseQuery>
              <queryType>JMESPathExpression</queryType>
              <query>[0].ten_sec.p_l3</query>
            </responseQuery>
          </restApiDataPointConfiguration>
        </dataPointListElement>
      </dataPointList>
    </functionalProfileListElement>
  </functionalProfileList>
</RestApiDeviceFrame>
